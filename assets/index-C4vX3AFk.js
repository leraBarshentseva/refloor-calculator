(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(n){if(n.ep)return;n.ep=!0;const c=a(n);fetch(n.href,c)}})();const b="refloor_calculator_state",s={brick:"visualizer__brick",brickMain:"visualizer__brick--base",brickAdd:"visualizer__brick--add",brickRemove:"visualizer__brick--remove",input:"visualizer__brick-input",removeButton:"visualizer__brick-remove",areaBrick:"visualizer__brick-area",errorBrick:"is-error",isDeleting:"is-deleting",isAppearing:"is-appearing"},f={MATERIAL:"pvc",LAYING:"direct",MAIN_WIDTH:3,MAIN_LENGTH:4},E={mainRoom:{width:f.MAIN_WIDTH,length:f.MAIN_LENGTH},segments:[],materialType:f.MATERIAL,layingMethod:f.LAYING},B={pvc:{price:1200,packSize:2.5},"spc-laminate":{price:1800,packSize:2.2},"quartz-parquet":{price:2500,packSize:1.8}},M={direct:{waste:5},diagonal:{waste:10},herringbone:{waste:15}},L=e=>{let t=parseFloat(e.value);return isNaN(t)?0:(t<0&&(t=Math.abs(t),e.value=t),t)},m=(e,t)=>{e.textContent!==t&&(e.classList.remove(`${s.isUpdateText}`),e.textContent=t,e.animate([{transform:"scale(1)",color:"inherit"},{transform:"scale(1.1)",color:"#8CCB5E",offset:.5},{transform:"scale(1)",color:"inherit"}],{duration:300,easing:"ease-out"}))},z=(e,t)=>{const a=e.querySelector(".visualizer__error-tooltip");a&&a.remove();const o=document.createElement("div");o.className="visualizer__error-tooltip",o.textContent=t,e.appendChild(o),setTimeout(()=>{o.remove()},3e3)},R=()=>{const e=localStorage.getItem(b);if(!e)return structuredClone(E);try{return JSON.parse(e)}catch{return console.warn("Ошибка чтения данных, сброс калькулятора"),localStorage.removeItem(b),structuredClone(E)}},i=R(),N=()=>{localStorage.setItem(b,JSON.stringify(i))},C=()=>{localStorage.removeItem(b)},D=()=>{const e=structuredClone(E);Object.assign(i,e)},r={mainRoom:{widthInput:document.getElementById("width"),lengthInput:document.getElementById("length")},baseBrick:{width:document.getElementById("base-brick-width"),length:document.getElementById("base-brick-length"),area:document.getElementById("base-brick-area")},buttons:{addSegment:document.querySelector('[data-action="add-segment"]'),subtractSegment:document.querySelector('[data-action="subtract-segment"]'),resetButton:document.querySelector(".calculator__reset-btn")},selects:{materialType:document.getElementById("material-type"),layingMethod:document.getElementById("laying-method")},containers:{visualizer:document.querySelector(".calculator__visualizer")},results:{area:document.getElementById("result-area"),waste:document.getElementById("result-waste"),material:document.getElementById("result-material"),totalPrice:document.getElementById("result-total-price"),packSize:document.getElementById("result-pack-size"),packCount:document.getElementById("result-pack-count"),pricePerMeter:document.getElementById("result-price-per-meter")}},P=()=>{let e=i.mainRoom.width*i.mainRoom.length;i.segments.length>0&&i.segments.forEach(g=>{const v=g.width*g.length;e+=g.type==="add"?v:-v}),e=Math.max(0,e);const t=B[i.materialType],o=M[i.layingMethod].waste,n=e*(o/100),c=e+n,l=Math.ceil(c/t.packSize),u=l*t.packSize,S=u*t.price;return{baseArea:e,wastePercent:o,wasteArea:n,finalAreaToBuy:u,totalPrice:S,packsNeeded:l,packSize:t.packSize,pricePerMeter:t.price}},x=()=>{confirm("Вы уверены, что хотите сбросить расчет?")&&(D(),C(),W(),A(),_(),k(),d())},q=e=>{i.segments=i.segments.filter(t=>t.id!==e),H(e),d()},H=e=>{const t=r.containers.visualizer.querySelector(`[data-id="${e}"]`);t&&(t.classList.add(s.isDeleting),setTimeout(()=>{t.remove()},300))},F=(e,t)=>{let a=0;for(const o of i.segments)if(o.type===e&&(a++,o.id===t))return a;return a},I=e=>{const t={id:crypto.randomUUID(),type:e,width:0,length:0};i.segments.push(t),w(t),d()},w=e=>{const t=O(e);r.containers.visualizer.insertAdjacentHTML("beforeend",t)},O=e=>{const t=F(e.type,e.id),a=e.type==="add"?s.brickAdd:s.brickRemove,o=e.type==="add"?`Доп. площадь #${t}`:`Вычет #${t}`,n=e.type==="add"?"+":"−",c=e.width*e.length;return`
      <div class="${s.brick} ${a} ${s.isAppearing}" data-id="${e.id}">
        <h5 class="visualizer__brick-title">${o}</h5>
        <button class="${s.removeButton}" aria-label="Удалить этот сегмент">×</button>
        <div class="visualizer__brick-body">
          <div class="visualizer__brick-group">
            <span class="visualizer__brick-label">Ширина</span>
            <input class="${s.input}" name="width" type="number" value="${e.width}" min="0">
          </div>
          <span>×</span>
          <div class="visualizer__brick-group">
            <span class="visualizer__brick-label">Длина</span>
            <input class="${s.input}" name="length" type="number" value="${e.length}" min="0">
          </div>
        </div>
        <div class="${s.areaBrick}">${n} S = ${c.toFixed(2)} м<sup>2</sup></div>
      </div>
    `},U=e=>{m(r.results.area,`${e.baseArea.toFixed(2)} м²`),m(r.results.waste,`${e.wasteArea.toFixed(2)} м² (${e.wastePercent}%)`),m(r.results.material,`${e.finalAreaToBuy.toFixed(2)} м²`),m(r.results.packSize,`${e.packSize} м²`),m(r.results.packCount,`${e.packsNeeded} шт.`),m(r.results.pricePerMeter,`${e.pricePerMeter.toLocaleString("ru-RU")} ₽`),m(r.results.totalPrice,`${e.totalPrice.toLocaleString("ru-RU",{maximumFractionDigits:0})} ₽`)},d=()=>{N();const e=P();U(e)},k=()=>{r.baseBrick.width.value=i.mainRoom.width,r.baseBrick.length.value=i.mainRoom.length,r.baseBrick.area.innerHTML=`S = ${(i.mainRoom.width*i.mainRoom.length).toFixed(2)} м<sup>2</sup>`},G=()=>{i.segments.length!==0&&i.segments.forEach(e=>{w(e)})},A=()=>{r.selects.materialType&&(r.selects.materialType.value=i.materialType),r.selects.layingMethod&&(r.selects.layingMethod.value=i.layingMethod)},_=()=>{r.mainRoom.widthInput.value=i.mainRoom.width,r.mainRoom.lengthInput.value=i.mainRoom.length},W=()=>{r.containers.visualizer.querySelectorAll(`.${s.brick}:not(.${s.brickMain})`).forEach(t=>t.remove())},Y=e=>{const t=e.target.closest(`.${s.input}`);if(!t)return;const a=t.closest(`.${s.brick}`);if(a.classList.contains(`${s.brickMain}`))return;const o=a.dataset.id,n=i.segments.find(h=>h.id===o),c=t.name==="width",l=t.name==="length",u=L(t);if(n.type==="subtract"){let h=i.mainRoom.width*i.mainRoom.length;i.segments.forEach(p=>{if(p.id===o)return;const y=p.width*p.length;p.type==="add"?h+=y:h-=y});const T=c?u:n.width;if((l?u:n.length)*T>h){const p=a.querySelector('input[name="width"]'),y=a.querySelector('input[name="length"]');p.value=0,y.value=0,a.classList.add(`${s.errorBrick}`),setTimeout(()=>{a.classList.remove(`${s.errorBrick}`)},500),z(a,"Вычитаемая площадь больше исходной"),n.width=0,n.length=0;const $=a.querySelector(`.${s.areaBrick}`);$.innerHTML="− S = 0.00 м<sup>2</sup>",d();return}}c&&(n.width=u),l&&(n.length=u);const S=a.querySelector(`.${s.areaBrick}`),g=n.type==="add"?"+":"−",v=n.width*n.length;S.innerHTML=`${g} S = ${v.toFixed(2)} м<sup>2</sup>`,d()},j=()=>{document.addEventListener("keydown",e=>{e.target.type==="number"&&["-","+","e","E"].includes(e.key)&&e.preventDefault()}),r.containers.visualizer.addEventListener("animationend",e=>{e.target.classList.contains(`${s.isAppearing}`)&&e.target.classList.remove(`${s.isAppearing}`)}),r.buttons.resetButton.addEventListener("click",x),r.buttons.addSegment.addEventListener("click",e=>{e.preventDefault(),I("add")}),r.buttons.subtractSegment.addEventListener("click",e=>{e.preventDefault(),I("subtract")}),r.mainRoom.widthInput.addEventListener("input",e=>{i.mainRoom.width=L(r.mainRoom.widthInput),k(),d()}),r.mainRoom.lengthInput.addEventListener("input",e=>{i.mainRoom.length=L(r.mainRoom.lengthInput),k(),d()}),r.selects.materialType.addEventListener("change",()=>{i.materialType=r.selects.materialType.value,d()}),r.selects.layingMethod.addEventListener("change",()=>{i.layingMethod=r.selects.layingMethod.value,d()}),r.containers.visualizer.addEventListener("click",e=>{const t=e.target.closest(`.${s.removeButton}`);if(!t)return;e.preventDefault();const a=t.closest(`.${s.brick}`);q(a.dataset.id)}),r.containers.visualizer.addEventListener("input",e=>{Y(e)})},J=()=>{j(),i.segments.length>0&&G(),A(),_(),k(),d()};J();
